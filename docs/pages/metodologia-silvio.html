<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metodologia - Inferência Geoespacial</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1 class="header-title">
                <span class="icon icon-map"></span>
                Inferência Geoespacial Aplicada à Geração de Base Vetorial Rodoviária: Estudo de Caso para o Estado de São Paulo
            </h1>
            <p class="header-subtitle">Base estimada: Malha municipal estimada - PLI/SP (OSM + DER/SP + SEADE)</p>
        </div>
    </header>

    <nav class="nav">
        <div class="nav-container">
            <ul class="nav-list">
                <li class="nav-item"><a href="../index.html" class="nav-link">Início</a></li>
                <li class="nav-item"><a href="dados.html" class="nav-link">Dados</a></li>
                <li class="nav-item"><a href="metodologia-silvio.html" class="nav-link active">Metodologia</a></li>
                <li class="nav-item"><a href="resultados.html" class="nav-link">Resultados</a></li>
                <li class="nav-item"><a href="mapas.html" class="nav-link">Mapas</a></li>
                <li class="nav-item"><a href="conclusao.html" class="nav-link">Conclusão</a></li>
                <li class="nav-item"><a href="pesquisa-municipal.html" class="nav-link">Pesquisa Municipal</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <h1 class="page-title">Metodologia</h1>
        <p class="page-subtitle">Fluxo técnico para estimar a malha vicinal paulista com rastreabilidade e justificativas</p>

        <section class="section">
            <h2 class="section-title">Enquadramento Científico</h2>
            <div class="section-content">
                <p>Adotamos um desenho metodológico replicável, guiado por princípios de ciência de dados espaciais: <strong>completude</strong> (maximizar cobertura territorial), <strong>especificidade</strong> (excluir ruído urbano e duplicidades), <strong>rastreabilidade</strong> (parâmetros explícitos e versionados) e <strong>auditabilidade</strong> (passo a passo documentado). Cada decisão técnica é tomada para minimizar viés de superestimação (inclusão de vias urbanas) ou subestimação (exclusão indevida por buffers).</p>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Arquitetura Metodológica</h2>
            <div class="cards-grid">
                <div class="card">
                    <h4 class="card-title">Princípios</h4>
                    <div class="card-content">
                        <ul class="list-tight">
                            <li>Reprodutibilidade: scripts versionados e parâmetros declarados.</li>
                            <li>Conservadorismo espacial: remover sobreposições urbanas e rodovias estaduais.</li>
                            <li>Comparabilidade: métricas homogêneas por município e RA.</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h4 class="card-title">Entradas</h4>
                    <div class="card-content">
                        <ul class="list-tight">
                            <li>OSM (Sudeste, nov/2025) — malha viária completa.</li>
                            <li>DER/SP (mai/2025) — cadastro oficial estadual.</li>
                            <li>IBGE 2019 (áreas urbanas) e Faces 2022 — exclusão urbana fina.</li>
                            <li>SEADE — limites municipais e RAs.</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h4 class="card-title">Saídas</h4>
                    <div class="card-content">
                        <ul class="list-tight">
                            <li>Segmentos OSM filtrados (GeoPackage).</li>
                            <li>Agregados municipais e por RA (tabelas comparativas).</li>
                            <li>Indicadores de densidade e razão OSM/DER.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Passo a Passo Detalhado</h2>
            <div class="section-content">
                <h3 class="section-subtitle">1) Preparação e harmonização</h3>
                <ul class="list-spaced">
                    <li><strong>Clip OSM para SP (SIRGAS 2000 / UTM 23S):</strong> garante extensão compatível com limites oficiais e reduz volume computacional.</li>
                    <li><strong>Enriquecimento com SEADE:</strong> agrega <em>Cod_ibge</em> e <em>GID_RA</em> para permitir análises multiescala.</li>
                </ul>

                <h3 class="section-subtitle">2) Filtragem de ruído urbano</h3>
                <ul class="list-spaced">
                    <li><strong>Intersect com Faces de Logradouro (buffer 10 m):</strong> remove vias intraquadra; evita superestimação por mapeamento denso em áreas urbanas.</li>
                    <li><strong>Intersect com Áreas Urbanas IBGE 2019:</strong> assegura alinhamento com perímetros oficiais, reduzindo viés metropolitano.</li>
                </ul>

                <h3 class="section-subtitle">3) Subtração da rede estadual</h3>
                <ul class="list-spaced">
                    <li><strong>Buffer DER 60–100 m:</strong> margens ampliadas evitam duplicidade com vicinais paralelas; intervalo escolhido para absorver imprecisões de alinhamento.</li>
                    <li><strong>Máscara de exclusão:</strong> vias que intersectam o buffer DER são descartadas, garantindo que a malha resultante seja exclusivamente municipal.</li>
                </ul>

                <h3 class="section-subtitle">4) Seleção final de vicinais</h3>
                <div class="table-container mt-1">
                    <table>
                        <thead>
                            <tr>
                                <th>Critério</th>
                                <th>Condição</th>
                                <th>Por que aplicar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Exclusão urbana</td>
                                <td><code>area_urb = 0</code></td>
                                <td>Evita inflar malha com ruas locais.</td>
                            </tr>
                            <tr>
                                <td>Exclusão logradouro</td>
                                <td><code>path = NULL</code></td>
                                <td>Retira vias censitárias urbanas remanescentes.</td>
                            </tr>
                            <tr>
                                <td>Exclusão DER</td>
                                <td><code>malha_der = 0</code></td>
                                <td>Remove sobreposições com a rede estadual.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Insumos e Consolidação</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Dataset</th>
                            <th>Fonte</th>
                            <th>Features</th>
                            <th>Uso</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>OSM Sudeste</strong></td>
                            <td>Geofabrik (Nov/2025)</td>
                            <td>1.358.788 ways (SP)</td>
                            <td>Base de vias</td>
                        </tr>
                        <tr>
                            <td><strong>Áreas Urbanas</strong></td>
                            <td>IBGE 2019</td>
                            <td>16.042 polígonos</td>
                            <td>Exclusão urbana</td>
                        </tr>
                        <tr>
                            <td><strong>Faces Logradouro</strong></td>
                            <td>IBGE Censo 2022</td>
                            <td>~2,4 milhões (SP)</td>
                            <td>Exclusão vias censitárias</td>
                        </tr>
                        <tr>
                            <td><strong>Malha DER</strong></td>
                            <td>DER/SP (Mai/2025)</td>
                            <td>7.417 segmentos</td>
                            <td>Subtração da rede estadual</td>
                        </tr>
                        <tr>
                            <td><strong>Municípios SEADE</strong></td>
                            <td>Fundação SEADE</td>
                            <td>645 polígonos</td>
                            <td>Agregação municipal/RA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Sequenciamento Operacional</h2>
            <h3 class="section-subtitle">Arquivos de execução (QGIS + R)</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Descrição</th>
                            <th>Features</th>
                            <th>Novos atributos</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>_01_SP_OSM.shp</code></td>
                            <td>Clip OSM + atributos municipais/RA</td>
                            <td>1.358.788</td>
                            <td>Cod_ibge, GID_RA</td>
                        </tr>
                        <tr>
                            <td><code>_02_FL_SP_OSM.shp</code></td>
                            <td>Intersect faces logradouro</td>
                            <td>1.205.819</td>
                            <td>path</td>
                        </tr>
                        <tr>
                            <td><code>_03_AU_FL_SP_OSM.shp</code></td>
                            <td>Intersect áreas urbanas</td>
                            <td>1.319.976</td>
                            <td>area_urb</td>
                        </tr>
                        <tr>
                            <td><code>_04_DER_AU_FL_SP_OSM.shp</code></td>
                            <td>Intersect buffer DER (60–100 m)</td>
                            <td>1.390.882</td>
                            <td>malha_der</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="alert alert-warning mt-2">
                <strong>Nota:</strong> contagem aumenta após intersecções devido à fragmentação de segmentos, efeito esperado e controlado na agregação.</div>
        </section>

        <section class="section">
            <h2 class="section-title">Agregação e Comparação</h2>
            <div class="section-content">
                <p><strong>Arquivo:</strong> <code>_05_SumarizacaoSHP.R</code></p>
                <pre><code>library(sp)
library(rgdal)
library(dplyr)
library(writexl)

# Leitura
SHPMUN <- readShapePoly("LimiteMunicipal_SEADE.shp")
SHPDER <- readShapePoly("Rodovias_municipais_wgsutm23s_intesect_mun.shp")
SHPOSM <- readShapePoly("_04_DER_AU_FL_SP_OSM_wgs84Utm23s.shp")

# Filtro vicinais: fora de área urbana e fora do buffer DER
OSM_vicinais <- subset(SHPOSM, area_urb == 0 & malha_der == 0)

# Agregação por município
DER_resumo <- SHPDER %>%
  group_by(Cod_ibge) %>%
  summarise(Vic_DER_metros = sum(metros, na.rm = TRUE),
            Vic_DER_qtde   = n())

OSM_resumo <- OSM_vicinais %>%
  group_by(Cod_ibge) %>%
  summarise(Vic_OSM_metros = sum(metros, na.rm = TRUE),
            Vic_OSM_qtde   = n())

# Join com base municipal
resultado <- SHPMUN %>%
  left_join(DER_resumo,  by = "Cod_ibge") %>%
  left_join(OSM_resumo,  by = "Cod_ibge")

# Exportação
write_xlsx(resultado, "_06_Comparacao_DER_vs_OSM.xlsx")</code></pre>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Resultados Sintetizados</h2>
            <div class="stats-container">
                <div class="stat-box">
                    <span class="stat-label">Vicinais OSM (agregado)</span>
                    <span class="stat-value">155.273 <span class="stat-unit">(km)</span></span>
                    <span class="stat-info">Mapeamento colaborativo completo</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Vicinais DER (oficial)</span>
                    <span class="stat-value">25.919 <span class="stat-unit">(km)</span></span>
                    <span class="stat-info">Cadastro estadual</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Razão OSM/DER</span>
                    <span class="stat-value">6,0 <span class="stat-unit">(×)</span></span>
                    <span class="stat-info">Grau de subnotificação</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Cobertura OSM</span>
                    <span class="stat-value">644</span>
                    <span class="stat-info">Municípios com geometria</span>
                </div>
            </div>
            <p class="section-content"><code>_06_Comparacao_DER_vs_OSM.xlsx</code> consolida 645 linhas (municípios) com atributos de identificação, métricas DER/OSM e densidades.</p>
        </section>

        <section class="section">
            <h2 class="section-title">Robustez e Limitações</h2>
            <div class="cards-grid">
                <div class="card">
                    <h4 class="card-title">Robustez</h4>
                    <div class="card-content">
                        <ul class="list-tight">
                            <li>Filtros urbanos multiescala (IBGE 2019 + Faces 2022).</li>
                            <li>Subtração explícita da rede estadual.</li>
                            <li>Agregação multiescala (município e RA) com métricas consistentes.</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h4 class="card-title">Limitações</h4>
                    <div class="card-content">
                        <ul class="list-tight">
                            <li>Buffer DER amplo pode excluir vicinais paralelas próximas.</li>
                            <li>Fragmentação pós-intersect exige agregação para interpretar extensão.</li>
                            <li>Dependência de qualidade do OSM em áreas de menor contribuição voluntária.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">Inferência Geoespacial Aplicada à Geração de Base Vetorial Rodoviária: Estudo de Caso para o Estado de São Paulo | Janeiro 2026</p>
            <p class="footer-text">Dados: Malha municipal estimada - PLI/SP (OSM + DER/SP + SEADE/IBGE)</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
